
> fathom-extract@0.1.0 test
> node --test

✔ renderBrief includes author in Who field if no speakers (5.357792ms)
✔ renderBrief prefers speakers over author (2.738584ms)
✔ renderBrief handles missing author and speakers (0.411667ms)
✔ renderBrief suggests clearing cache for cache/cookie issues (6.076791ms)
✔ renderBrief suggests clearing cache for local storage mention (4.144958ms)
✔ brief CLI does not crash when URL fetch fails; prints NOTE to stderr (148.994041ms)
✔ brief CLI supports F2A_NO_NOTE=1 to suppress stderr NOTE on fetch failure (127.237292ms)
✔ brief CLI accepts bare fathom.video URLs (no scheme) and normalizes to https:// (453.592833ms)
✔ brief CLI prints version with --version (83.114417ms)
✔ brief CLI documents --copy-brief in --help output (69.35025ms)
✔ brief CLI documents --version in --help output (62.408625ms)
✔ brief CLI documents --template in --help output (59.199042ms)
✔ brief CLI supports --template (no fetch required) (65.521625ms)
✔ brief CLI supports --cmd to override the command name shown in the brief (69.660667ms)
✔ brief CLI help mentions chat/markdown URL wrappers (69.61775ms)
✔ brief CLI supports --json (outputs {source,title,brief}) (92.12625ms)
✔ brief CLI supports --json --compact-json (single-line JSON) (92.604958ms)
✔ brief CLI supports env var F2A_COMPACT_JSON=1 as a default for --compact-json (92.000916ms)
✔ brief CLI accepts angle-bracket wrapped URLs (chat/markdown copy-paste) (92.237041ms)
✔ brief CLI accepts Slack-style wrapped URLs (<url|label>) (94.402666ms)
✔ brief CLI accepts Slack-style wrapped URLs even when surrounded by chat punctuation (95.138666ms)
✔ brief CLI accepts markdown link URLs ([label](url)) (92.01025ms)
✔ brief CLI strips common trailing chat punctuation from URLs (278.356917ms)
✔ brief CLI strips parenthetical labels after URLs (92.359583ms)
✔ brief CLI accepts smart-quoted URLs (common mobile copy/paste) (96.579209ms)
✔ brief CLI accepts guillemet-wrapped URLs (locale quotes) (93.953375ms)
✔ brief CLI accepts brace-wrapped URLs (common in some copy/paste contexts) (92.375292ms)
✔ brief CLI supports --out to write the generated brief to a file (92.486584ms)
✔ brief CLI allows --out to be a directory (writes bug-report-brief.md inside it) (93.837333ms)
✔ brief CLI allows --out to be a directory with --json (writes bug-report-brief.json inside it) (90.039834ms)
✔ brief CLI supports env var F2A_OUT as a default for --out (87.41575ms)
✔ brief CLI expands ~ in --out paths (home dir) (87.073208ms)
✔ brief CLI treats --out - as stdout (does not create a file named "-") (87.95325ms)
✔ brief CLI supports env vars to hide teaser/timestamps (F2A_MAX_*) (85.184375ms)
✔ brief CLI ignores empty env var overrides for F2A_MAX_* (treats as unset) (86.138625ms)
✔ brief CLI supports env var to enable clipboard copy (F2A_COPY) (88.828042ms)
✔ renderBrief: uses (unknown) placeholder for missing optional fields (3.78775ms)
✔ renderBrief suggests checking logs for crashes (6.413333ms)
✔ renderBrief suggests checking network for slow/timeout issues (2.488334ms)
✔ renderBrief suggests checking permissions for auth issues (0.185542ms)
✔ renderBrief suggests checking database for migration issues (0.137291ms)
✔ renderBrief always suggests reproducing locally (0.15875ms)
✔ renderBrief suggests testing on device/simulator for mobile issues (0.189583ms)
✔ renderBrief produces minimal markdown with empty input (6.635292ms)
✔ renderBrief includes source and title (2.089458ms)
✔ renderBrief includes transcript teaser (3.088375ms)
✔ renderBrief respects timestamp limit (0.175167ms)
✔ renderBrief handles various bullet styles (0.737666ms)
✔ renderBrief uses description for 1-sentence summary (0.131292ms)
✔ renderBrief supports custom repro steps (1.210584ms)
✔ renderBrief is resilient to undefined optional fields (7.270708ms)
✔ renderBrief handles fetchError objects gracefully (0.154083ms)
✔ renderBrief limits fall back to default on invalid input (3.093833ms)
✔ renderBrief respects zero limits (0.18925ms)
✔ renderBrief handles whitespace-only source as unknown (0.128625ms)
✔ extracts unique speakers from transcript (4.570917ms)
✔ handles empty transcript (1.992625ms)
✔ generateNextActions detects feature flags (1.767333ms)
✔ generateNextActions detects A/B tests (0.945125ms)
✔ generateNextActions detects canary deployments (0.07625ms)
✔ brief extracts Expected/Actual from transcript (2.886167ms)
✔ brief generates Next Actions based on keywords (server error / latency) (1.529625ms)
✔ brief extracts environment from transcript (0.552041ms)
✔ renderBrief extracts bug hints with "fails" and "crashes" (7.864542ms)
✔ legacy wrapper prints version when --version is provided (80.62975ms)
✔ extract CLI prints version when --version is provided (86.996042ms)
✔ legacy wrapper behaves like brief generator (markdown output) (252.187875ms)
✔ still writes stub artifacts when URL fetch fails and --out-dir is provided (111.423084ms)
✔ supports auth-gated pages via FATHOM_COOKIE (266.862125ms)
✔ extract CLI accepts chat-wrapped URLs (angle brackets / Slack links) and strips trailing punctuation (504.685417ms)
✔ cookie file supports JSON exports (name/value pairs) (96.445875ms)
✔ cookie file supports a raw Cookie header (Cookie: ...) (96.419417ms)
✔ cookie file supports a Cookie header line embedded among other headers (98.725542ms)
✔ sets mediaDownloadError when download is enabled but mediaUrl is missing (90.760416ms)
✔ extract tool resolves media URLs found in JSON (no extension) via content-type probe (101.172541ms)
✔ prefers copy_transcript endpoint when present (better transcript extraction) (129.896958ms)
✔ passes cookie + referer + user-agent when downloading media with ffmpeg (182.290542ms)
✔ supports --user-agent to override UA for media download (181.028875ms)
✔ extract tool can download + split media into segments (local server) (188.281083ms)
✔ supports --referer for pages that require a Referer header (99.006333ms)
✔ supports FATHOM_REFERER env var for pages that require a Referer header (97.223333ms)
✔ formatCsv: formats expected fields correctly (0.728ms)
✔ formatCsv: handles special characters (0.096583ms)
✔ Transcript teaser preserves data: URIs (does not treat "data" as speaker) (11.4165ms)
✔ normalizeFetchedContent extracts description from meta tags (2.021291ms)
✔ normalizeFetchedContent extracts description from name="description" fallback (0.552708ms)
✔ generateNextActions detects Figma/Design keywords (1.749667ms)
✔ generateNextActions detects design mismatch keywords (0.946084ms)
✔ renderBrief extracts Staging environment (7.884458ms)
✔ renderBrief extracts Production environment (3.15525ms)
✔ renderBrief extracts Prod (normalized) environment (0.181083ms)
✔ renderBrief extracts Localhost environment (0.474166ms)
✔ renderBrief ignores "prod" inside other words (0.151708ms)
✔ extractPaths finds URL paths in text (0.938416ms)
✔ extractPaths ignores common words (0.085625ms)
✔ Golden input: normalizeFetchedContent extracts title, media, and transcript correctly (2.066833ms)
✔ MIG-14: generateNextActions detects PDF/Export issues (1.750292ms)
✔ MIG-14: generateNextActions detects corrupted export (0.927416ms)
✔ heuristics: suggests checking browser console for explicit console mentions (2.614833ms)
✔ normalizeFetchedContent preserves line breaks for <br/> tags (1.929917ms)
✔ normalizeFetchedContent decodes &apos; in <title> (1.94275ms)
✔ normalizeFetchedContent tolerates invalid numeric HTML entities (no throw) (0.593792ms)
✔ normalizeFetchedContent decodes common named punctuation entities in <title> (0.197709ms)
✔ normalizeFetchedContent falls back to h1 when title/meta are missing (1.9915ms)
✔ scripts/linear.mjs prints help with --help and exits 0 (no env required) (76.343042ms)
✔ scripts/linear.mjs exits non-zero on unknown command and prints help (66.941709ms)
✔ scripts/linear.mjs exits non-zero when missing issue key (67.811625ms)
✔ MIG-14: generateNextActions detects 404/Not Found (9.063458ms)
✔ MIG-14: generateNextActions detects Accessibility (a11y) issues (1.765042ms)
✔ MIG-14: generateNextActions detects Screen Reader issues (0.940875ms)
✔ MIG-14: generateNextActions detects Contrast issues (0.075416ms)
▶ MIG-14: Heuristics - Analytics
  ✔ suggests checking analytics when Segment/Mixpanel is mentioned locally (1.541208ms)
  ✔ suggests checking analytics when GA4 is mentioned (0.955834ms)
  ✔ detects generic tracking issues (0.075875ms)
✔ MIG-14: Heuristics - Analytics (3.231167ms)
✔ MIG-14: generateNextActions detects API tools (Postman/curl) (2.702417ms)
✔ MIG-14: generateNextActions detects 400/Bad Request input issues (10.795791ms)
✔ MIG-14: generateNextActions detects CDN / Asset issues (4.898667ms)
✔ MIG-14: generateNextActions detects Session/Token issues (1.802ms)
✔ MIG-14: generateNextActions detects Invalid Token errors (0.9565ms)
✔ MIG-14: generateNextActions detects CSRF errors (0.083833ms)
✔ MIG-14: generateNextActions specifically suggests checking Auth headers for 401 (0.067625ms)
✔ MIG-14: generateNextActions detects Audio/Video device issues (1.965083ms)
✔ MIG-14: extractBugHints detects blank/white screen (8.396041ms)
✔ extracts git SHA from transcript (5.185583ms)
✔ extracts git SHA with colon prefix (2.705833ms)
✔ extracts complex semver with suffix (0.588042ms)
✔ MIG-14: generateNextActions detects CORS errors (1.745541ms)
✔ MIG-14: generateNextActions detects 429 Too Many Requests (0.959333ms)
✔ MIG-14: generateNextActions detects Database errors (duplicate keys/deadlocks) (1.885875ms)
✔ MIG-14: extractEnvironment detects Oppo (6.282375ms)
✔ MIG-14: extractEnvironment detects Vivo (2.55025ms)
✔ MIG-14: extractEnvironment detects Realme (0.171375ms)
✔ extractEnvironment detects specific Android devices (5.417084ms)
✔ extractEnvironment detects Galaxy devices (3.702ms)
✔ extractEnvironment detects Motorola devices (0.20625ms)
✔ MIG-14: generateNextActions detects Email delivery issues (1.77225ms)
✔ MIG-14: generateNextActions detects Bounced emails (0.941041ms)
✔ MIG-14: extractEnvironment detects Arc browser (6.818458ms)
▶ extractEnvironment items
  ✔ detects CentOS (6.5175ms)
  ✔ detects Mint (2.602875ms)
  ✔ detects Surface device (0.158083ms)
✔ extractEnvironment items (9.965709ms)
✔ MIG-14: extractEnvironment detects Orion (5.266958ms)
✔ MIG-14: extractEnvironment detects Vivaldi (6.476959ms)
✔ MIG-14: extractEnvironment detects Chromium (3.094542ms)
✔ MIG-14: extractEnvironment detects DuckDuckGo (0.165ms)
✔ MIG-14: extractEnvironment detects Ubuntu (0.196208ms)
✔ MIG-14: extractEnvironment detects Samsung Internet (0.130417ms)
✔ MIG-14: extractEnvironment detects macOS Mojave (5.468833ms)
✔ MIG-14: extractEnvironment detects macOS High Sierra (3.054ms)
✔ MIG-14: extractEnvironment detects macOS Sierra (0.161375ms)
✔ MIG-14: extractEnvironment detects macOS El Capitan (0.139792ms)
✔ MIG-14: extractEnvironment detects macOS Yosemite (0.144541ms)
✔ MIG-14: extractEnvironment detects macOS Mavericks (0.137042ms)
✔ MIG-14: extractEnvironment detects macOS Sequoia (5.398959ms)
✔ MIG-14: extractEnvironment detects macOS Sonoma (3.105291ms)
✔ MIG-14: extractEnvironment detects macOS Ventura (0.167292ms)
✔ MIG-14: extractEnvironment detects macOS Monterey (0.140875ms)
✔ MIG-14: generateNextActions detects Browser Extension / Ad blocker issues (2.672416ms)
▶ MIG-14: generateNextActions detects feature flags extended providers
  ✔ detects PostHog related feature flag issues (2.116416ms)
  ✔ detects GrowthBook related feature flag issues (0.983417ms)
✔ MIG-14: generateNextActions detects feature flags extended providers (3.738ms)
✔ MIG-14: generateNextActions detects Feature Flag issues (2.673084ms)
✔ MIG-14: extractBugHints detects glitches (9.211875ms)
✔ MIG-14: generateNextActions detects GraphQL issues (2.67725ms)
✔ MIG-14: extractBugHints detects frozen/stuck states (8.65725ms)
✔ MIG-14: detect internalization / i18n issues (2.706708ms)
▶ MIG-14: Heuristics - Third-party Integrations
  ✔ suggests checking integrations when Slack is mentioned locally (1.621ms)
  ✔ suggests checking integrations when Salesforce is mentioned (0.957708ms)
  ✔ suggests checking integrations when HubSpot is mentioned (0.08325ms)
  ✔ suggests checking integrations when Zapier is mentioned (0.080666ms)
  ✔ suggests checking integrations when Zoom/Calendar is mentioned (0.079208ms)
✔ MIG-14: Heuristics - Third-party Integrations (3.795958ms)
✔ MIG-14: generateNextActions detects Disk Space issues (1.748333ms)
✔ MIG-14: generateNextActions detects Out of Memory / OOM (0.934667ms)
✔ MIG-14: extractEnvironment detects iOS from iPhone (5.419083ms)
✔ MIG-14: extractEnvironment detects iOS from iPad (3.049542ms)
✔ MIG-14: extractEnvironment detects Android (0.15475ms)
✔ MIG-14: extractEnvironment detects plain iOS (0.127625ms)
✔ MIG-14: generateNextActions detects Redis / Connection issues (2.660208ms)
✔ MIG-14: generateNextActions detects File Upload / Size issues (0.140416ms)
✔ MIG-14: extractBugHints detects "broken", "timed out", "laggy" (0.8545ms)
✔ generateNextActions detects pagination issues (1.794542ms)
✔ generateNextActions detects infinite scroll issues (0.98275ms)
▶ MIG-14: Heuristics - Payment/Billing
  ✔ suggests checking Stripe/Billing when payment keywords are present in hints (3.031208ms)
  ✔ suggests checking Stripe/Billing when payment keywords are present in transcript (0.481667ms)
  ✔ detects "invoice" and "subscription" keywords (0.088708ms)
✔ MIG-14: Heuristics - Payment/Billing (4.265875ms)
✔ normalizeUrlLike handles "Fathom recording:" prefix (1.176417ms)
✔ normalizeUrlLike handles "Fathom share:" prefix (0.319917ms)
✔ MIG-14: generateNextActions detects "stopped working" as regression (6.255542ms)
✔ MIG-14: generateNextActions detects regression indicators (7.415833ms)
✔ MIG-14: generateNextActions detects Search issues (2.024792ms)
✔ MIG-14: generateNextActions detects Timezone issues (0.962166ms)
✔ MIG-14: generateNextActions detects 500/server errors without explicit "error" keyword (6.575125ms)
✔ MIG-14: extractSeverity should recognize P1 as High (0.7905ms)
✔ MIG-14: extractSeverity should recognize SEV-2 as High (0.132542ms)
✔ extractSeverity detects Critical/Blocker keywords (0.832458ms)
✔ extractSeverity detects High priority keywords (0.126417ms)
✔ extractSeverity returns empty string for normal text (0.061375ms)
✔ renderBrief includes Severity field when high/critical (4.939667ms)
✔ renderBrief omits Severity field when normal (3.145417ms)
✔ MIG-14: extractBugHints detects infinite spinner (6.234666ms)
✔ MIG-14: extractBugHints detects infinite loading (4.103791ms)
✔ MIG-14: generateNextActions detects 503 Service Unavailable explicitly (1.794833ms)
✔ MIG-14: generateNextActions detects 502 Bad Gateway explicitly (0.934709ms)
✔ MIG-14: generateNextActions detects 504 Gateway Time-out explicitly (0.077458ms)
✔ MIG-14: renderBrief provides placeholder for missing description (4.734542ms)
✔ renderBrief extracts timestamp from deep-linked URL (7.5285ms)
✔ MIG-14: detects UI/UX issues and suggests CSS checks (7.248708ms)
✔ MIG-14: Suggests checking Websockets for realtime issues (4.159875ms)
✔ MIG-14: renderBrief handles undefined inputs gracefully (3.554042ms)
✔ MIG-14: renderBrief handles empty objects (1.721458ms)
✔ MIG-14: renderBrief handles missing transcript (0.126416ms)
✔ MIG-14: renderBrief includes fetch error when provided (0.113708ms)
✔ MIG-14: renderBrief includes fetch error but preserves title if known (0.116875ms)
✔ MIG-14: renderBrief accepts url as an alias for source (0.39925ms)
✔ MIG-14: renderBrief extracts version/build numbers (2.487ms)
✔ MIG-14: extractEnvironment detects specific Windows versions (12.248084ms)
✔ normalizeFetchedContent returns empty title if missing (4.568833ms)
✔ normalizeUrlLike handles basic URLs (1.81525ms)
✔ normalizeUrlLike strips common prefixes (0.114583ms)
✔ normalizeUrlLike handles angle brackets and slack style (0.082458ms)
✔ normalizeUrlLike handles markdown (0.062833ms)
✔ normalizeUrlLike handles trailing punctuation on bare URLs (0.077208ms)
✔ normalizeUrlLike handles copy-paste quotes (0.053667ms)
✔ normalizeUrlLike handles unusual brackets (0.047167ms)
✔ MIG-14: Resilience - renderBrief handles null/undefined input object (4.862708ms)
✔ MIG-14: Resilience - renderBrief handles partial input object (2.427792ms)
✔ MIG-14: Resilience - renderBrief handles null values in fields (0.76375ms)
✔ MIG-14: Resilience - normalizeUrlLike handles garbage types gracefully (0.682417ms)
✔ MIG-14: Resilience - extractFromStdin handles empty content (0.765667ms)
✔ MIG-14: Resilience - extractFromStdin handles garbage content without crashing (0.384125ms)
✔ resolveAuthor extracts author from meta tag (1.007666ms)
✔ resolveAuthor returns null when missing (0.068334ms)
✔ extractFromStdin extracts Author header (1.290875ms)
✔ extractFromStdin extracts By header (0.084375ms)
✔ resolveAuthor handles metadata with mixed quotes (0.071333ms)
✔ resolveAuthor handles reversed attributes (0.058875ms)
✔ strips short speaker labels (6.633292ms)
✔ preserves long prefixes (avoids false positive speakers) (3.198375ms)
✔ handles role labels (0.162542ms)
✔ extractFromStdin: parses Author field (2.001167ms)
✔ extractFromStdin: parses Who field (0.114125ms)
✔ extractFromStdin: parses By field (0.099833ms)
✔ extractFromStdin: parses Date field (2.1ms)
✔ extractFromStdin: mixed order (0.151583ms)
✔ renderBrief: includes Date in output (4.370292ms)
✔ extractFromStdin strips common trailing chat punctuation from Source URLs (1.914875ms)
✔ extractFromStdin also strips common Unicode trailing punctuation from Source URLs (0.894667ms)
✔ extractFromStdin strips additional locale punctuation (guillemets / CJK brackets) from Source URLs (0.09675ms)
✔ extractFromStdin accepts guillemet-wrapped Source URLs (locale quotes) (0.190917ms)
✔ extractFromStdin strips trailing brace punctuation from Source URLs (0.081959ms)
✔ extractFromStdin supports markdown headings like "## Title" (2.122709ms)
✔ extractFromStdin accepts bare fathom.video URLs (no scheme) and normalizes to https:// (0.17925ms)
✔ extractFromStdin tolerates quoted envelope lines (">", ">>", etc.) for Source and Title (0.110125ms)
✔ extractFromStdin accepts angle-bracket wrapped Source URLs (0.094042ms)
✔ extractFromStdin accepts common chat wrappers around Source URLs (0.079083ms)
✔ extractFromStdin strips parenthetical labels after Source URLs (0.068459ms)
✔ extractFromStdin accepts curly-quoted Source URLs (smart quotes) (0.871375ms)
✔ extractFromStdin accepts "Source - <url>" style labels (dash separator) (0.07375ms)
✔ extractFromStdin accepts "Source = <url>" and "Title = ..." style labels (equals separator) (0.07025ms)
✔ extractFromStdin treats "Subject:" as a Title alias (0.106292ms)
✔ extractFromStdin treats "Topic:" as a Title alias (0.071125ms)
✔ extractFromStdin treats "Description:" as a Description (0.059083ms)
✔ extractFromStdin treats "Summary:" as a Description (0.051125ms)
✔ extractFromStdin accepts "Title - ..." style labels (dash separator) (0.044458ms)
✔ extractFromStdin accepts markdown link Sources like "[label](url)" (0.056125ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources (0.052834ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources even without a scheme (0.043333ms)
✔ extractFromStdin accepts "Recording:" as a Source alias (0.051042ms)
✔ extractFromStdin accepts "Meeting:" as a Source alias (0.037958ms)
✔ extractFromStdin accepts "Video link:" as a Source alias (0.036334ms)
✔ extractFromStdin accepts "Call:" as a Source alias (0.035167ms)
✔ extractFromStdin accepts "Fathom link:" as a Source alias (0.038333ms)
✔ extractFromStdin accepts "Share link:" as a Source alias (0.041833ms)
✔ extractFromStdin accepts "Meet link:" as a Source alias (0.037291ms)
✔ extractFromStdin accepts "Google Meet link:" as a Source alias (0.037167ms)
✔ extractFromStdin accepts "Teams link:" as a Source alias (0.038083ms)
✔ extractFromStdin accepts "Microsoft Teams link:" as a Source alias (0.033833ms)
✔ extractFromStdin accepts "Zoom link:" as a Source alias (0.033167ms)
✔ extractFromStdin accepts "Webex link:" as a Source alias (0.032667ms)
✔ extractFromStdin accepts "Loom link:" as a Source alias (0.032417ms)
✔ Suggested issue title uses description if available (5.891792ms)
✔ Suggested issue title falls back to title if description missing (3.232375ms)
✔ extractTimestamps finds hh:mm:ss patterns (1.966584ms)
✔ extractTimestamps respects max limit (0.105208ms)
✔ renderBrief promotes URL timestamp to top of Timestamps section (4.632625ms)
✔ extractTimestamps finds HH:MM:SS patterns (1.817667ms)
✔ extractTimestamps respects max limit (0.089583ms)
✔ extractTimestamps ignores duplicates (0.083916ms)
✔ normalizeUrlLike: extended aliases (1.461708ms)
ℹ tests 289
ℹ suites 4
ℹ pass 289
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3416.158334
