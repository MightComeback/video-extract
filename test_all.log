
> fathom-extract@0.1.0 test
> node --test

✔ renderBrief includes author in Who field if no speakers (4.820375ms)
✔ renderBrief prefers speakers over author (2.281ms)
✔ renderBrief handles missing author and speakers (0.409ms)
✔ renderBrief suggests clearing cache for cache/cookie issues (3.580917ms)
✔ renderBrief suggests clearing cache for local storage mention (4.800708ms)
✔ brief CLI does not crash when URL fetch fails; prints NOTE to stderr (135.983541ms)
✔ brief CLI supports F2A_NO_NOTE=1 to suppress stderr NOTE on fetch failure (115.992333ms)
✔ brief CLI accepts bare fathom.video URLs (no scheme) and normalizes to https:// (360.033541ms)
✔ brief CLI prints version with --version (68.604084ms)
✔ brief CLI documents --copy-brief in --help output (64.026042ms)
✔ brief CLI documents --version in --help output (60.549167ms)
✔ brief CLI documents --template in --help output (60.959333ms)
✔ brief CLI supports --template (no fetch required) (64.181333ms)
✔ brief CLI supports --cmd to override the command name shown in the brief (64.454ms)
✔ brief CLI help mentions chat/markdown URL wrappers (62.085209ms)
✔ brief CLI supports --json (outputs {source,title,brief}) (91.463792ms)
✔ brief CLI supports --json --compact-json (single-line JSON) (91.537167ms)
✔ brief CLI supports env var F2A_COMPACT_JSON=1 as a default for --compact-json (92.388833ms)
✔ brief CLI accepts angle-bracket wrapped URLs (chat/markdown copy-paste) (92.885666ms)
✔ brief CLI accepts Slack-style wrapped URLs (<url|label>) (92.8065ms)
✔ brief CLI accepts Slack-style wrapped URLs even when surrounded by chat punctuation (92.270709ms)
✔ brief CLI accepts markdown link URLs ([label](url)) (91.705834ms)
✔ brief CLI strips common trailing chat punctuation from URLs (279.4705ms)
✔ brief CLI strips parenthetical labels after URLs (94.105042ms)
✔ brief CLI accepts smart-quoted URLs (common mobile copy/paste) (94.022125ms)
✔ brief CLI accepts guillemet-wrapped URLs (locale quotes) (92.515667ms)
✔ brief CLI accepts brace-wrapped URLs (common in some copy/paste contexts) (94.461542ms)
✔ brief CLI supports --out to write the generated brief to a file (94.094791ms)
✔ brief CLI allows --out to be a directory (writes bug-report-brief.md inside it) (92.457875ms)
✔ brief CLI allows --out to be a directory with --json (writes bug-report-brief.json inside it) (93.423084ms)
✔ brief CLI supports env var F2A_OUT as a default for --out (88.528084ms)
✔ brief CLI expands ~ in --out paths (home dir) (87.565875ms)
✔ brief CLI treats --out - as stdout (does not create a file named "-") (87.238625ms)
✔ brief CLI supports env vars to hide teaser/timestamps (F2A_MAX_*) (87.257625ms)
✔ brief CLI ignores empty env var overrides for F2A_MAX_* (treats as unset) (86.318167ms)
✔ brief CLI supports env var to enable clipboard copy (F2A_COPY) (88.242ms)
✔ renderBrief: uses (unknown) placeholder for missing optional fields (3.256834ms)
✔ renderBrief suggests checking logs for crashes (13.8115ms)
✔ renderBrief suggests checking network for slow/timeout issues (2.278208ms)
✔ renderBrief suggests checking permissions for auth issues (0.171792ms)
✔ renderBrief suggests checking database for migration issues (0.13075ms)
✔ renderBrief always suggests reproducing locally (0.152542ms)
✔ renderBrief suggests testing on device/simulator for mobile issues (0.156041ms)
✔ renderBrief produces minimal markdown with empty input (3.007375ms)
✔ renderBrief includes source and title (1.538833ms)
✔ renderBrief includes transcript teaser (3.5325ms)
✔ renderBrief respects timestamp limit (0.223125ms)
✔ renderBrief handles various bullet styles (0.793333ms)
✔ renderBrief uses description for 1-sentence summary (0.13375ms)
✔ renderBrief is resilient to undefined optional fields (6.543584ms)
✔ renderBrief handles fetchError objects gracefully (0.147541ms)
✔ renderBrief limits fall back to default on invalid input (3.204125ms)
✔ renderBrief respects zero limits (0.144417ms)
✔ renderBrief handles whitespace-only source as unknown (0.125209ms)
✔ extracts unique speakers from transcript (4.003541ms)
✔ handles empty transcript (1.484708ms)
✔ generateNextActions detects feature flags (3.675667ms)
✔ generateNextActions detects A/B tests (0.675917ms)
✔ generateNextActions detects canary deployments (0.075708ms)
✔ brief extracts Expected/Actual from transcript (2.557125ms)
✔ brief generates Next Actions based on keywords (server error / latency) (0.692917ms)
✔ brief extracts environment from transcript (0.444166ms)
✔ renderBrief extracts bug hints with "fails" and "crashes" (7.03925ms)
✔ legacy wrapper prints version when --version is provided (84.852292ms)
✔ extract CLI prints version when --version is provided (86.177ms)
✔ legacy wrapper behaves like brief generator (markdown output) (251.314458ms)
✔ still writes stub artifacts when URL fetch fails and --out-dir is provided (123.184ms)
✔ supports auth-gated pages via FATHOM_COOKIE (215.329167ms)
✔ extract CLI accepts chat-wrapped URLs (angle brackets / Slack links) and strips trailing punctuation (490.194042ms)
✔ cookie file supports JSON exports (name/value pairs) (97.08375ms)
✔ cookie file supports a raw Cookie header (Cookie: ...) (97.16475ms)
✔ cookie file supports a Cookie header line embedded among other headers (97.818542ms)
✔ sets mediaDownloadError when download is enabled but mediaUrl is missing (92.046791ms)
✔ extract tool resolves media URLs found in JSON (no extension) via content-type probe (99.911708ms)
✔ prefers copy_transcript endpoint when present (better transcript extraction) (127.479209ms)
✔ passes cookie + referer + user-agent when downloading media with ffmpeg (183.65975ms)
✔ supports --user-agent to override UA for media download (180.768334ms)
✔ extract tool can download + split media into segments (local server) (192.232ms)
✔ supports --referer for pages that require a Referer header (95.6025ms)
✔ supports FATHOM_REFERER env var for pages that require a Referer header (95.893791ms)
✔ formatCsv: formats expected fields correctly (0.746584ms)
✔ formatCsv: handles special characters (0.104208ms)
✔ Transcript teaser preserves data: URIs (does not treat "data" as speaker) (8.355375ms)
✔ normalizeFetchedContent extracts description from meta tags (2.068542ms)
✔ normalizeFetchedContent extracts description from name="description" fallback (0.563625ms)
✔ renderBrief extracts Staging environment (4.95625ms)
✔ renderBrief extracts Production environment (2.917417ms)
✔ renderBrief extracts Prod (normalized) environment (0.167916ms)
✔ renderBrief extracts Localhost environment (0.356959ms)
✔ renderBrief ignores "prod" inside other words (0.12975ms)
✔ extractPaths finds URL paths in text (0.902375ms)
✔ extractPaths ignores common words (0.434625ms)
✔ Golden input: normalizeFetchedContent extracts title, media, and transcript correctly (2.138541ms)
✔ normalizeFetchedContent preserves line breaks for <br/> tags (2.5375ms)
✔ normalizeFetchedContent decodes &apos; in <title> (2.147333ms)
✔ normalizeFetchedContent tolerates invalid numeric HTML entities (no throw) (0.607292ms)
✔ normalizeFetchedContent decodes common named punctuation entities in <title> (0.205083ms)
✔ normalizeFetchedContent falls back to h1 when title/meta are missing (1.976334ms)
✔ scripts/linear.mjs prints help with --help and exits 0 (no env required) (79.784792ms)
✔ scripts/linear.mjs exits non-zero on unknown command and prints help (78.819416ms)
✔ scripts/linear.mjs exits non-zero when missing issue key (67.043584ms)
✔ MIG-14: generateNextActions detects 404/Not Found (6.014583ms)
✔ MIG-14: generateNextActions detects API tools (Postman/curl) (4.380958ms)
✔ MIG-14: generateNextActions detects 400/Bad Request input issues (7.646541ms)
✔ MIG-14: generateNextActions detects CDN / Asset issues (2.083084ms)
✔ MIG-14: extractBugHints detects blank/white screen (8.051541ms)
✔ extracts git SHA from transcript (5.203958ms)
✔ extracts git SHA with colon prefix (2.250959ms)
✔ extracts complex semver with suffix (0.581542ms)
✔ MIG-14: generateNextActions detects CORS errors (1.433375ms)
✔ MIG-14: generateNextActions detects 429 Too Many Requests (0.690375ms)
✔ extractEnvironment detects specific Android devices (5.525875ms)
✔ extractEnvironment detects Galaxy devices (2.655541ms)
✔ extractEnvironment detects Motorola devices (0.176125ms)
✔ MIG-14: generateNextActions detects Email delivery issues (1.466666ms)
✔ MIG-14: generateNextActions detects Bounced emails (0.89075ms)
✔ MIG-14: extractEnvironment detects Arc browser (7.795917ms)
▶ extractEnvironment items
  ✔ detects CentOS (5.715917ms)
  ✔ detects Mint (2.336916ms)
  ✔ detects Surface device (0.138416ms)
✔ extractEnvironment items (8.844959ms)
✔ MIG-14: extractEnvironment detects Orion (8.928291ms)
✔ MIG-14: extractEnvironment detects Vivaldi (7.502875ms)
✔ MIG-14: extractEnvironment detects Chromium (3.369291ms)
✔ MIG-14: extractEnvironment detects DuckDuckGo (0.15875ms)
✔ MIG-14: extractEnvironment detects Ubuntu (0.211917ms)
✔ MIG-14: extractEnvironment detects Samsung Internet (0.126583ms)
✔ MIG-14: generateNextActions detects Browser Extension / Ad blocker issues (2.044958ms)
✔ MIG-14: generateNextActions detects Feature Flag issues (2.075084ms)
✔ MIG-14: extractBugHints detects glitches (7.189208ms)
✔ MIG-14: extractBugHints detects frozen/stuck states (6.856083ms)
✔ MIG-14: detect internalization / i18n issues (2.039041ms)
✔ MIG-14: extractEnvironment detects iOS from iPhone (4.979208ms)
✔ MIG-14: extractEnvironment detects iOS from iPad (3.456334ms)
✔ MIG-14: extractEnvironment detects Android (0.696084ms)
✔ MIG-14: extractEnvironment detects plain iOS (0.188292ms)
✔ MIG-14: generateNextActions detects Redis / Connection issues (2.008833ms)
✔ MIG-14: generateNextActions detects File Upload / Size issues (0.11575ms)
▶ MIG-14: Heuristics - Payment/Billing
  ✔ suggests checking Stripe/Billing when payment keywords are present in hints (1.809583ms)
  ✔ suggests checking Stripe/Billing when payment keywords are present in transcript (0.406458ms)
  ✔ detects "invoice" and "subscription" keywords (0.075834ms)
✔ MIG-14: Heuristics - Payment/Billing (2.949ms)
✔ normalizeUrlLike handles "Fathom recording:" prefix (1.130209ms)
✔ normalizeUrlLike handles "Fathom share:" prefix (0.309541ms)
✔ MIG-14: generateNextActions detects "stopped working" as regression (4.800458ms)
✔ MIG-14: generateNextActions detects regression indicators (8.793791ms)
✔ MIG-14: generateNextActions detects Search issues (1.863875ms)
✔ MIG-14: generateNextActions detects Timezone issues (0.70525ms)
✔ MIG-14: generateNextActions detects 500/server errors without explicit "error" keyword (6.009292ms)
✔ extractSeverity detects Critical/Blocker keywords (0.845584ms)
✔ extractSeverity detects High priority keywords (0.116625ms)
✔ extractSeverity returns empty string for normal text (0.061ms)
✔ renderBrief includes Severity field when high/critical (4.354458ms)
✔ renderBrief omits Severity field when normal (2.696333ms)
✔ MIG-14: extractBugHints detects infinite spinner (5.391458ms)
✔ MIG-14: extractBugHints detects infinite loading (2.463375ms)
✔ MIG-14: generateNextActions detects 503 Service Unavailable explicitly (1.446208ms)
✔ MIG-14: generateNextActions detects 502 Bad Gateway explicitly (0.661375ms)
✔ MIG-14: generateNextActions detects 504 Gateway Time-out explicitly (0.067084ms)
✔ MIG-14: renderBrief provides placeholder for missing description (3.127458ms)
✔ renderBrief extracts timestamp from deep-linked URL (5.43575ms)
✔ MIG-14: detects UI/UX issues and suggests CSS checks (7.453834ms)
✔ MIG-14: renderBrief handles undefined inputs gracefully (3.657041ms)
✔ MIG-14: renderBrief handles empty objects (1.377417ms)
✔ MIG-14: renderBrief handles missing transcript (0.1295ms)
✔ MIG-14: renderBrief includes fetch error when provided (0.106041ms)
✔ MIG-14: renderBrief includes fetch error but preserves title if known (0.116792ms)
✔ MIG-14: renderBrief accepts url as an alias for source (0.428584ms)
✔ MIG-14: renderBrief extracts version/build numbers (1.895083ms)
✔ MIG-14: extractEnvironment detects specific Windows versions (9.711208ms)
✔ normalizeFetchedContent returns empty title if missing (1.915541ms)
✔ normalizeUrlLike handles basic URLs (1.405041ms)
✔ normalizeUrlLike strips common prefixes (0.111083ms)
✔ normalizeUrlLike handles angle brackets and slack style (0.075209ms)
✔ normalizeUrlLike handles markdown (0.058958ms)
✔ normalizeUrlLike handles trailing punctuation on bare URLs (0.075583ms)
✔ normalizeUrlLike handles copy-paste quotes (0.047667ms)
✔ normalizeUrlLike handles unusual brackets (0.045291ms)
✔ MIG-14: Resilience - renderBrief handles null/undefined input object (3.002083ms)
✔ MIG-14: Resilience - renderBrief handles partial input object (1.276083ms)
✔ MIG-14: Resilience - renderBrief handles null values in fields (0.118292ms)
✔ MIG-14: Resilience - normalizeUrlLike handles garbage types gracefully (0.574458ms)
✔ MIG-14: Resilience - extractFromStdin handles empty content (1.466583ms)
✔ MIG-14: Resilience - extractFromStdin handles garbage content without crashing (0.376333ms)
✔ resolveAuthor extracts author from meta tag (0.978584ms)
✔ resolveAuthor returns null when missing (0.072917ms)
✔ extractFromStdin extracts Author header (1.251917ms)
✔ extractFromStdin extracts By header (0.0825ms)
✔ resolveAuthor handles metadata with mixed quotes (0.068792ms)
✔ resolveAuthor handles reversed attributes (0.055292ms)
✔ strips short speaker labels (4.562416ms)
✔ preserves long prefixes (avoids false positive speakers) (2.68025ms)
✔ handles role labels (0.16475ms)
✔ extractFromStdin: parses Author field (1.9815ms)
✔ extractFromStdin: parses Who field (0.111291ms)
✔ extractFromStdin: parses By field (0.0945ms)
✔ extractFromStdin: parses Date field (2.015291ms)
✔ extractFromStdin: mixed order (0.153625ms)
✔ renderBrief: includes Date in output (3.81225ms)
✔ extractFromStdin strips common trailing chat punctuation from Source URLs (1.901333ms)
✔ extractFromStdin also strips common Unicode trailing punctuation from Source URLs (0.901583ms)
✔ extractFromStdin strips additional locale punctuation (guillemets / CJK brackets) from Source URLs (0.097584ms)
✔ extractFromStdin accepts guillemet-wrapped Source URLs (locale quotes) (0.177417ms)
✔ extractFromStdin strips trailing brace punctuation from Source URLs (0.079666ms)
✔ extractFromStdin supports markdown headings like "## Title" (2.651125ms)
✔ extractFromStdin accepts bare fathom.video URLs (no scheme) and normalizes to https:// (0.205667ms)
✔ extractFromStdin tolerates quoted envelope lines (">", ">>", etc.) for Source and Title (0.12175ms)
✔ extractFromStdin accepts angle-bracket wrapped Source URLs (0.099541ms)
✔ extractFromStdin accepts common chat wrappers around Source URLs (0.082958ms)
✔ extractFromStdin strips parenthetical labels after Source URLs (0.07375ms)
✔ extractFromStdin accepts curly-quoted Source URLs (smart quotes) (0.876125ms)
✔ extractFromStdin accepts "Source - <url>" style labels (dash separator) (0.079417ms)
✔ extractFromStdin accepts "Source = <url>" and "Title = ..." style labels (equals separator) (0.073458ms)
✔ extractFromStdin treats "Subject:" as a Title alias (0.117458ms)
✔ extractFromStdin treats "Topic:" as a Title alias (0.083166ms)
✔ extractFromStdin treats "Description:" as a Description (0.060417ms)
✔ extractFromStdin treats "Summary:" as a Description (0.053ms)
✔ extractFromStdin accepts "Title - ..." style labels (dash separator) (0.045125ms)
✔ extractFromStdin accepts markdown link Sources like "[label](url)" (0.044459ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources (0.048791ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources even without a scheme (0.049583ms)
✔ extractFromStdin accepts "Recording:" as a Source alias (0.064125ms)
✔ extractFromStdin accepts "Meeting:" as a Source alias (0.05225ms)
✔ extractFromStdin accepts "Video link:" as a Source alias (0.037458ms)
✔ extractFromStdin accepts "Call:" as a Source alias (0.034375ms)
✔ extractFromStdin accepts "Fathom link:" as a Source alias (0.036791ms)
✔ extractFromStdin accepts "Share link:" as a Source alias (0.034375ms)
✔ extractFromStdin accepts "Meet link:" as a Source alias (0.039667ms)
✔ extractFromStdin accepts "Google Meet link:" as a Source alias (0.038459ms)
✔ extractFromStdin accepts "Teams link:" as a Source alias (0.0395ms)
✔ extractFromStdin accepts "Microsoft Teams link:" as a Source alias (0.03525ms)
✔ extractFromStdin accepts "Zoom link:" as a Source alias (0.03475ms)
✔ extractFromStdin accepts "Webex link:" as a Source alias (0.050875ms)
✔ extractFromStdin accepts "Loom link:" as a Source alias (0.034541ms)
✔ extractTimestamps finds hh:mm:ss patterns (1.63875ms)
✔ extractTimestamps respects max limit (0.085666ms)
✔ renderBrief promotes URL timestamp to top of Timestamps section (4.27475ms)
✔ extractTimestamps finds HH:MM:SS patterns (1.656917ms)
✔ extractTimestamps respects max limit (0.089334ms)
✔ extractTimestamps ignores duplicates (0.073834ms)
✔ normalizeUrlLike: extended aliases (1.357958ms)
ℹ tests 239
ℹ suites 2
ℹ pass 239
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3267.474333
