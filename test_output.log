
> fathom-extract@0.1.0 test
> node --test

✔ renderBrief includes author in Who field if no speakers (9.187709ms)
✔ renderBrief prefers speakers over author (2.338166ms)
✔ renderBrief handles missing author and speakers (0.628875ms)
✔ renderBrief suggests clearing cache for cache/cookie issues (3.551458ms)
✔ renderBrief suggests clearing cache for local storage mention (1.76625ms)
✔ brief CLI does not crash when URL fetch fails; prints NOTE to stderr (133.288917ms)
✔ brief CLI supports F2A_NO_NOTE=1 to suppress stderr NOTE on fetch failure (124.5715ms)
✔ brief CLI accepts bare fathom.video URLs (no scheme) and normalizes to https:// (363.647959ms)
✔ brief CLI prints version with --version (62.697041ms)
✔ brief CLI documents --copy-brief in --help output (63.152083ms)
✔ brief CLI documents --version in --help output (61.040292ms)
✔ brief CLI documents --template in --help output (58.628459ms)
✔ brief CLI supports --template (no fetch required) (64.135292ms)
✔ brief CLI supports --cmd to override the command name shown in the brief (64.67325ms)
✔ brief CLI help mentions chat/markdown URL wrappers (60.265166ms)
✔ brief CLI supports --json (outputs {source,title,brief}) (91.477875ms)
✔ brief CLI supports --json --compact-json (single-line JSON) (90.950042ms)
✔ brief CLI supports env var F2A_COMPACT_JSON=1 as a default for --compact-json (91.5365ms)
✔ brief CLI accepts angle-bracket wrapped URLs (chat/markdown copy-paste) (92.3505ms)
✔ brief CLI accepts Slack-style wrapped URLs (<url|label>) (93.750958ms)
✔ brief CLI accepts Slack-style wrapped URLs even when surrounded by chat punctuation (91.45ms)
✔ brief CLI accepts markdown link URLs ([label](url)) (92.685125ms)
✔ brief CLI strips common trailing chat punctuation from URLs (278.158584ms)
✔ brief CLI strips parenthetical labels after URLs (93.600958ms)
✔ brief CLI accepts smart-quoted URLs (common mobile copy/paste) (92.844208ms)
✔ brief CLI accepts guillemet-wrapped URLs (locale quotes) (92.265167ms)
✔ brief CLI accepts brace-wrapped URLs (common in some copy/paste contexts) (92.868666ms)
✔ brief CLI supports --out to write the generated brief to a file (94.823375ms)
✔ brief CLI allows --out to be a directory (writes bug-report-brief.md inside it) (91.5135ms)
✔ brief CLI allows --out to be a directory with --json (writes bug-report-brief.json inside it) (94.084417ms)
✔ brief CLI supports env var F2A_OUT as a default for --out (89.383041ms)
✔ brief CLI expands ~ in --out paths (home dir) (87.102875ms)
✔ brief CLI treats --out - as stdout (does not create a file named "-") (87.108541ms)
✔ brief CLI supports env vars to hide teaser/timestamps (F2A_MAX_*) (83.858459ms)
✔ brief CLI ignores empty env var overrides for F2A_MAX_* (treats as unset) (85.532542ms)
✔ brief CLI supports env var to enable clipboard copy (F2A_COPY) (88.464ms)
✔ renderBrief: uses (unknown) placeholder for missing optional fields (3.323333ms)
✔ renderBrief suggests checking logs for crashes (12.420125ms)
✔ renderBrief suggests checking network for slow/timeout issues (2.452667ms)
✔ renderBrief suggests checking permissions for auth issues (0.177ms)
✔ renderBrief suggests checking database for migration issues (0.131875ms)
✔ renderBrief always suggests reproducing locally (0.15ms)
✔ renderBrief suggests testing on device/simulator for mobile issues (0.162125ms)
✔ renderBrief produces minimal markdown with empty input (2.937875ms)
✔ renderBrief includes source and title (1.522084ms)
✔ renderBrief includes transcript teaser (2.599958ms)
✔ renderBrief respects timestamp limit (0.132458ms)
✔ renderBrief handles various bullet styles (0.651792ms)
✔ renderBrief uses description for 1-sentence summary (0.111209ms)
✔ renderBrief is resilient to undefined optional fields (4.203ms)
✔ renderBrief handles fetchError objects gracefully (0.128959ms)
✔ renderBrief limits fall back to default on invalid input (3.086708ms)
✔ renderBrief respects zero limits (0.134916ms)
✔ renderBrief handles whitespace-only source as unknown (0.114166ms)
✔ extracts unique speakers from transcript (3.909416ms)
✔ handles empty transcript (1.455375ms)
✔ generateNextActions detects feature flags (1.478375ms)
✔ generateNextActions detects A/B tests (0.657792ms)
✔ generateNextActions detects canary deployments (0.075625ms)
✔ brief extracts Expected/Actual from transcript (3.267291ms)
✔ brief generates Next Actions based on keywords (server error / latency) (0.771375ms)
✔ brief extracts environment from transcript (0.463625ms)
✔ renderBrief extracts bug hints with "fails" and "crashes" (7.642333ms)
✔ legacy wrapper prints version when --version is provided (89.608875ms)
✔ extract CLI prints version when --version is provided (79.648833ms)
✔ legacy wrapper behaves like brief generator (markdown output) (277.397625ms)
✔ still writes stub artifacts when URL fetch fails and --out-dir is provided (116.702542ms)
✔ supports auth-gated pages via FATHOM_COOKIE (203.938834ms)
✔ extract CLI accepts chat-wrapped URLs (angle brackets / Slack links) and strips trailing punctuation (484.560209ms)
✔ cookie file supports JSON exports (name/value pairs) (97.521875ms)
✔ cookie file supports a raw Cookie header (Cookie: ...) (96.8215ms)
✔ cookie file supports a Cookie header line embedded among other headers (97.114958ms)
✔ sets mediaDownloadError when download is enabled but mediaUrl is missing (90.492625ms)
✔ extract tool resolves media URLs found in JSON (no extension) via content-type probe (99.524916ms)
✔ prefers copy_transcript endpoint when present (better transcript extraction) (125.667375ms)
✔ passes cookie + referer + user-agent when downloading media with ffmpeg (183.375209ms)
✔ supports --user-agent to override UA for media download (180.0005ms)
✔ extract tool can download + split media into segments (local server) (191.761875ms)
✔ supports --referer for pages that require a Referer header (97.556792ms)
✔ supports FATHOM_REFERER env var for pages that require a Referer header (95.706416ms)
✔ formatCsv: formats expected fields correctly (0.983583ms)
✔ formatCsv: handles special characters (0.112792ms)
✔ Transcript teaser preserves data: URIs (does not treat "data" as speaker) (6.28675ms)
✔ normalizeFetchedContent extracts description from meta tags (2.006667ms)
✔ normalizeFetchedContent extracts description from name="description" fallback (0.556416ms)
✔ renderBrief extracts Staging environment (6.211292ms)
✔ renderBrief extracts Production environment (2.675417ms)
✔ renderBrief extracts Prod (normalized) environment (0.151917ms)
✔ renderBrief extracts Localhost environment (0.335625ms)
✔ renderBrief ignores "prod" inside other words (0.129416ms)
✔ extractPaths finds URL paths in text (0.875875ms)
✔ extractPaths ignores common words (0.081459ms)
✔ Golden input: normalizeFetchedContent extracts title, media, and transcript correctly (2.073709ms)
✔ normalizeFetchedContent preserves line breaks for <br/> tags (1.892708ms)
✔ normalizeFetchedContent decodes &apos; in <title> (1.964583ms)
✔ normalizeFetchedContent tolerates invalid numeric HTML entities (no throw) (0.601208ms)
✔ normalizeFetchedContent decodes common named punctuation entities in <title> (0.20025ms)
✔ normalizeFetchedContent falls back to h1 when title/meta are missing (3.072291ms)
✔ scripts/linear.mjs prints help with --help and exits 0 (no env required) (81.635541ms)
✔ scripts/linear.mjs exits non-zero on unknown command and prints help (68.992625ms)
✔ scripts/linear.mjs exits non-zero when missing issue key (70.868792ms)
✔ MIG-14: generateNextActions detects 404/Not Found (6.55725ms)
✔ MIG-14: generateNextActions detects API tools (Postman/curl) (1.950792ms)
✔ MIG-14: generateNextActions detects 400/Bad Request input issues (9.196291ms)
✔ MIG-14: generateNextActions detects CDN / Asset issues (2.033958ms)
✔ MIG-14: extractBugHints detects blank/white screen (7.48525ms)
✔ extracts git SHA from transcript (4.801042ms)
✔ extracts git SHA with colon prefix (2.189625ms)
✔ extracts complex semver with suffix (0.551583ms)
✔ MIG-14: generateNextActions detects CORS errors (2.979292ms)
✔ MIG-14: generateNextActions detects 429 Too Many Requests (1.200958ms)
✔ extractEnvironment detects specific Android devices (5.15825ms)
✔ extractEnvironment detects Galaxy devices (2.594375ms)
✔ extractEnvironment detects Motorola devices (0.157ms)
✔ MIG-14: generateNextActions detects Email delivery issues (1.670125ms)
✔ MIG-14: generateNextActions detects Bounced emails (1.328167ms)
✔ MIG-14: extractEnvironment detects Arc browser (4.834208ms)
▶ extractEnvironment items
  ✔ detects CentOS (6.691167ms)
  ✔ detects Mint (3.606834ms)
  ✔ detects Surface device (0.159625ms)
✔ extractEnvironment items (11.142167ms)
✔ MIG-14: extractEnvironment detects Orion (7.061792ms)
✔ MIG-14: extractEnvironment detects Vivaldi (4.780834ms)
✔ MIG-14: extractEnvironment detects Chromium (2.54525ms)
✔ MIG-14: extractEnvironment detects DuckDuckGo (0.134292ms)
✔ MIG-14: extractEnvironment detects Ubuntu (0.615083ms)
✔ MIG-14: extractEnvironment detects Samsung Internet (0.1225ms)
✔ MIG-14: generateNextActions detects Browser Extension / Ad blocker issues (2.018833ms)
✔ MIG-14: generateNextActions detects Feature Flag issues (1.978375ms)
✔ MIG-14: extractBugHints detects glitches (6.701791ms)
✔ MIG-14: extractBugHints detects frozen/stuck states (6.675292ms)
✔ MIG-14: detect internalization / i18n issues (2.00025ms)
✔ MIG-14: extractEnvironment detects iOS from iPhone (5.191875ms)
✔ MIG-14: extractEnvironment detects iOS from iPad (2.700917ms)
✔ MIG-14: extractEnvironment detects Android (0.164875ms)
✔ MIG-14: extractEnvironment detects plain iOS (0.117709ms)
✔ MIG-14: generateNextActions detects Redis / Connection issues (1.981875ms)
✔ MIG-14: generateNextActions detects File Upload / Size issues (0.113416ms)
✔ normalizeUrlLike handles "Fathom recording:" prefix (1.193417ms)
✔ normalizeUrlLike handles "Fathom share:" prefix (0.322ms)
✔ MIG-14: generateNextActions detects "stopped working" as regression (5.003708ms)
✔ MIG-14: generateNextActions detects regression indicators (6.144291ms)
✔ MIG-14: generateNextActions detects Search issues (1.4945ms)
✔ MIG-14: generateNextActions detects Timezone issues (0.64925ms)
✔ MIG-14: generateNextActions detects 500/server errors without explicit "error" keyword (6.284875ms)
✔ extractSeverity detects Critical/Blocker keywords (0.870667ms)
✔ extractSeverity detects High priority keywords (0.116709ms)
✔ extractSeverity returns empty string for normal text (0.070917ms)
✔ renderBrief includes Severity field when high/critical (4.335584ms)
✔ renderBrief omits Severity field when normal (2.974791ms)
✔ MIG-14: extractBugHints detects infinite spinner (7.601416ms)
✔ MIG-14: extractBugHints detects infinite loading (2.49025ms)
✔ MIG-14: generateNextActions detects 503 Service Unavailable explicitly (2.861542ms)
✔ MIG-14: generateNextActions detects 502 Bad Gateway explicitly (0.849375ms)
✔ MIG-14: generateNextActions detects 504 Gateway Time-out explicitly (0.091292ms)
✔ MIG-14: renderBrief provides placeholder for missing description (2.921584ms)
✔ renderBrief extracts timestamp from deep-linked URL (4.858834ms)
✔ MIG-14: detects UI/UX issues and suggests CSS checks (5.702333ms)
✔ MIG-14: renderBrief handles undefined inputs gracefully (3.405ms)
✔ MIG-14: renderBrief handles empty objects (1.30575ms)
✔ MIG-14: renderBrief handles missing transcript (0.135625ms)
✔ MIG-14: renderBrief includes fetch error when provided (0.106084ms)
✔ MIG-14: renderBrief includes fetch error but preserves title if known (0.111792ms)
✔ MIG-14: renderBrief accepts url as an alias for source (0.420875ms)
✔ MIG-14: renderBrief extracts version/build numbers (1.895209ms)
✔ MIG-14: extractEnvironment detects specific Windows versions (8.147375ms)
✔ normalizeFetchedContent returns empty title if missing (1.878459ms)
✔ normalizeUrlLike handles basic URLs (1.408166ms)
✔ normalizeUrlLike strips common prefixes (0.108167ms)
✔ normalizeUrlLike handles angle brackets and slack style (0.069542ms)
✔ normalizeUrlLike handles markdown (0.057125ms)
✔ normalizeUrlLike handles trailing punctuation on bare URLs (0.071458ms)
✔ normalizeUrlLike handles copy-paste quotes (0.049125ms)
✔ normalizeUrlLike handles unusual brackets (0.04575ms)
✔ MIG-14: Resilience - renderBrief handles null/undefined input object (4.245291ms)
✔ MIG-14: Resilience - renderBrief handles partial input object (1.277208ms)
✔ MIG-14: Resilience - renderBrief handles null values in fields (0.119667ms)
✔ MIG-14: Resilience - normalizeUrlLike handles garbage types gracefully (0.578792ms)
✔ MIG-14: Resilience - extractFromStdin handles empty content (1.557916ms)
✔ MIG-14: Resilience - extractFromStdin handles garbage content without crashing (0.417208ms)
✔ resolveAuthor extracts author from meta tag (0.963834ms)
✔ resolveAuthor returns null when missing (0.064541ms)
✔ extractFromStdin extracts Author header (1.249042ms)
✔ extractFromStdin extracts By header (0.0805ms)
✔ resolveAuthor handles metadata with mixed quotes (0.070334ms)
✔ resolveAuthor handles reversed attributes (0.05375ms)
✔ strips short speaker labels (6.643584ms)
✔ preserves long prefixes (avoids false positive speakers) (2.609958ms)
✔ handles role labels (0.157584ms)
✔ extractFromStdin: parses Author field (1.976959ms)
✔ extractFromStdin: parses Who field (0.137792ms)
✔ extractFromStdin: parses By field (0.098625ms)
✔ extractFromStdin: parses Date field (2.008792ms)
✔ extractFromStdin: mixed order (0.14575ms)
✔ renderBrief: includes Date in output (4.308125ms)
✔ extractFromStdin strips common trailing chat punctuation from Source URLs (1.928167ms)
✔ extractFromStdin also strips common Unicode trailing punctuation from Source URLs (0.895958ms)
✔ extractFromStdin strips additional locale punctuation (guillemets / CJK brackets) from Source URLs (0.101292ms)
✔ extractFromStdin accepts guillemet-wrapped Source URLs (locale quotes) (0.183958ms)
✔ extractFromStdin strips trailing brace punctuation from Source URLs (0.081167ms)
✔ extractFromStdin supports markdown headings like "## Title" (2.475583ms)
✔ extractFromStdin accepts bare fathom.video URLs (no scheme) and normalizes to https:// (0.186958ms)
✔ extractFromStdin tolerates quoted envelope lines (">", ">>", etc.) for Source and Title (0.108667ms)
✔ extractFromStdin accepts angle-bracket wrapped Source URLs (0.090458ms)
✔ extractFromStdin accepts common chat wrappers around Source URLs (0.079416ms)
✔ extractFromStdin strips parenthetical labels after Source URLs (0.0805ms)
✔ extractFromStdin accepts curly-quoted Source URLs (smart quotes) (0.880083ms)
✔ extractFromStdin accepts "Source - <url>" style labels (dash separator) (0.073333ms)
✔ extractFromStdin accepts "Source = <url>" and "Title = ..." style labels (equals separator) (0.090458ms)
✔ extractFromStdin treats "Subject:" as a Title alias (0.10375ms)
✔ extractFromStdin treats "Topic:" as a Title alias (0.071ms)
✔ extractFromStdin treats "Description:" as a Description (0.069458ms)
✔ extractFromStdin treats "Summary:" as a Description (0.0565ms)
✔ extractFromStdin accepts "Title - ..." style labels (dash separator) (0.043083ms)
✔ extractFromStdin accepts markdown link Sources like "[label](url)" (0.041709ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources (0.04575ms)
✔ extractFromStdin accepts Slack-style "<url|label>" Sources even without a scheme (0.061042ms)
✔ extractFromStdin accepts "Recording:" as a Source alias (0.07225ms)
✔ extractFromStdin accepts "Meeting:" as a Source alias (0.037542ms)
✔ extractFromStdin accepts "Video link:" as a Source alias (0.033834ms)
✔ extractFromStdin accepts "Call:" as a Source alias (0.03325ms)
✔ extractFromStdin accepts "Fathom link:" as a Source alias (0.03625ms)
✔ extractFromStdin accepts "Share link:" as a Source alias (0.033958ms)
✔ extractFromStdin accepts "Meet link:" as a Source alias (0.031667ms)
✔ extractFromStdin accepts "Google Meet link:" as a Source alias (0.030833ms)
✔ extractFromStdin accepts "Teams link:" as a Source alias (0.030542ms)
✔ extractFromStdin accepts "Microsoft Teams link:" as a Source alias (0.03ms)
✔ extractFromStdin accepts "Zoom link:" as a Source alias (0.04ms)
✔ extractFromStdin accepts "Webex link:" as a Source alias (0.04625ms)
✔ extractFromStdin accepts "Loom link:" as a Source alias (0.029458ms)
✔ extractTimestamps finds hh:mm:ss patterns (1.660541ms)
✔ extractTimestamps respects max limit (0.087541ms)
✔ renderBrief promotes URL timestamp to top of Timestamps section (4.020291ms)
✔ extractTimestamps finds HH:MM:SS patterns (1.630958ms)
✔ extractTimestamps respects max limit (0.084667ms)
✔ extractTimestamps ignores duplicates (0.065917ms)
✔ normalizeUrlLike: extended aliases (1.40125ms)
ℹ tests 236
ℹ suites 1
ℹ pass 236
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3268.567292
